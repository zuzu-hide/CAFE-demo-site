<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ã‚¿ãƒƒãƒ•ç”¨æ³¨æ–‡ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: rgb(62, 48, 5);
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: rgb(160, 133, 84);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .filters button {
            padding: 10px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filters button.active {
            background: rgb(62, 48, 5);
            color: white;
            border-color: rgb(62, 48, 5);
        }

        .orders-grid {
            display: grid;
            gap: 20px;
        }

        .order-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .order-id {
            font-weight: bold;
            color: rgb(62, 48, 5);
            font-size: 16px;
        }

        .order-time {
            color: #666;
            font-size: 14px;
        }

        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-pending {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-processing {
            background: #fef3c7;
            color: #92400e;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .customer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-label {
            color: #666;
            font-size: 14px;
        }

        .info-value {
            font-weight: 600;
            color: #333;
        }

        .order-items {
            margin-bottom: 20px;
        }

        .item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f9f9f9;
            margin-bottom: 8px;
            border-radius: 6px;
        }

        .item-name {
            font-weight: 600;
        }

        .item-details {
            color: #666;
            font-size: 14px;
        }

        .total {
            text-align: right;
            font-size: 24px;
            font-weight: bold;
            color: rgb(160, 133, 84);
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
            margin-bottom: 20px;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-processing {
            background: #f59e0b;
            color: white;
        }

        .btn-complete {
            background: #10b981;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: rgb(62, 48, 5);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            transform: rotate(180deg) scale(1.1);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 12px;
        }

        .empty-state h2 {
            color: #666;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid rgb(62, 48, 5);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ã‚¹ã‚¿ãƒƒãƒ•ç”¨æ³¨æ–‡ç®¡ç†</h1>
            <p style="color: #666;">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ³¨æ–‡ã‚’ç¢ºèªãƒ»ç®¡ç†ã§ãã¾ã™</p>
        </header>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalOrders">0</div>
                <div class="stat-label">ç·æ³¨æ–‡æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingOrders">0</div>
                <div class="stat-label">æœªå¯¾å¿œ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="processingOrders">0</div>
                <div class="stat-label">å¯¾å¿œä¸­</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedOrders">0</div>
                <div class="stat-label">å®Œäº†</div>
            </div>
        </div>

        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="filters">
            <span style="font-weight: 600; color: #666;">è¡¨ç¤º:</span>
            <button class="active" onclick="filterOrders('all')">å…¨ã¦</button>
            <button onclick="filterOrders('æœªå¯¾å¿œ')">æœªå¯¾å¿œ</button>
            <button onclick="filterOrders('å¯¾å¿œä¸­')">å¯¾å¿œä¸­</button>
            <button onclick="filterOrders('å®Œäº†')">å®Œäº†</button>
        </div>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 20px; color: #666;">æ³¨æ–‡ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

        <!-- æ³¨æ–‡ä¸€è¦§ -->
        <div class="orders-grid" id="ordersContainer"></div>

        <!-- ç©ºçŠ¶æ…‹ -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <h2>ğŸ“­ æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</h2>
            <p style="color: #999;">æ–°ã—ã„æ³¨æ–‡ãŒå…¥ã‚‹ã¨è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
        </div>
    </div>

    <!-- æ›´æ–°ãƒœã‚¿ãƒ³ -->
    <button class="refresh-btn" onclick="loadOrders()" title="æ›´æ–°">ğŸ”„</button>

    <script>
        let allOrders = [];
        let currentFilter = 'all';

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ³¨æ–‡ã‚’å–å¾—
        window.addEventListener('load', () => {
            loadOrders();
            // 30ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
            setInterval(loadOrders, 30000);
        });

        // æ³¨æ–‡ã‚’èª­ã¿è¾¼ã‚€
        async function loadOrders() {
            try {
                const response = await fetch('http://localhost:5000/api/orders');
                const data = await response.json();

                if (data.success) {
                    allOrders = data.orders.reverse(); // æ–°ã—ã„é †
                    updateStats();
                    displayOrders(currentFilter);
                }

                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('loading').innerHTML = 
                    '<p style="color: #ef4444;">âš ï¸ ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“</p>';
            }
        }

        // çµ±è¨ˆã‚’æ›´æ–°
        function updateStats() {
            const total = allOrders.length;
            const pending = allOrders.filter(o => o.status === 'æœªå¯¾å¿œ').length;
            const processing = allOrders.filter(o => o.status === 'å¯¾å¿œä¸­').length;
            const completed = allOrders.filter(o => o.status === 'å®Œäº†').length;

            document.getElementById('totalOrders').textContent = total;
            document.getElementById('pendingOrders').textContent = pending;
            document.getElementById('processingOrders').textContent = processing;
            document.getElementById('completedOrders').textContent = completed;
        }

        // æ³¨æ–‡ã‚’è¡¨ç¤º
        function displayOrders(filter) {
            currentFilter = filter;
            const container = document.getElementById('ordersContainer');
            const emptyState = document.getElementById('emptyState');

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
            let filteredOrders = allOrders;
            if (filter !== 'all') {
                filteredOrders = allOrders.filter(o => o.status === filter);
            }

            // ç©ºã®å ´åˆ
            if (filteredOrders.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            container.innerHTML = '';

            // å„æ³¨æ–‡ã‚’è¡¨ç¤º
            filteredOrders.forEach(order => {
                const orderCard = createOrderCard(order);
                container.appendChild(orderCard);
            });
        }

        // æ³¨æ–‡ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
        function createOrderCard(order) {
            const card = document.createElement('div');
            card.className = 'order-card';

            const statusClass = 
                order.status === 'æœªå¯¾å¿œ' ? 'status-pending' :
                order.status === 'å¯¾å¿œä¸­' ? 'status-processing' :
                'status-completed';

            const time = new Date(order.timestamp).toLocaleString('ja-JP');

            // å•†å“ãƒªã‚¹ãƒˆ
            const itemsHTML = order.orderData.items.map(item => `
                <div class="item">
                    <div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-details">â‚±${item.price} Ã— ${item.quantity || item.qty || 1}</div>
                    </div>
                    <div class="item-name">â‚±${item.price * (item.quantity || item.qty || 1)}</div>
                </div>
            `).join('');

            card.innerHTML = `
                <div class="order-header">
                    <div>
                        <div class="order-id">æ³¨æ–‡ID: ${order.orderId}</div>
                        <div class="order-time">â° ${time}</div>
                    </div>
                    <span class="status-badge ${statusClass}">${order.status}</span>
                </div>

                <div class="customer-info">
                    <div class="info-item">
                        <span class="info-label">ğŸ‘¤ ãŠåå‰:</span>
                        <span class="info-value">${order.userInfo.username || order.userInfo.fullName}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ğŸ  éƒ¨å±‹ç•ªå·:</span>
                        <span class="info-value">${order.userInfo.roomNumber}</span>
                    </div>
                    ${order.userInfo.comments ? `
                    <div class="info-item" style="grid-column: 1/-1;">
                        <span class="info-label">ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ:</span>
                        <span class="info-value">"${order.userInfo.comments}"</span>
                    </div>
                    ` : ''}
                </div>

                <div class="order-items">
                    <strong style="color: rgb(62, 48, 5); margin-bottom: 10px; display: block;">ğŸ›’ æ³¨æ–‡å†…å®¹:</strong>
                    ${itemsHTML}
                </div>

                <div class="total">åˆè¨ˆ: â‚±${order.orderData.totalPrice}</div>

                <div class="actions">
                    ${order.status === 'æœªå¯¾å¿œ' ? `
                        <button class="btn btn-processing" onclick="updateStatus('${order.orderId}', 'å¯¾å¿œä¸­')">
                            å¯¾å¿œé–‹å§‹
                        </button>
                    ` : ''}
                    ${order.status === 'å¯¾å¿œä¸­' ? `
                        <button class="btn btn-complete" onclick="updateStatus('${order.orderId}', 'å®Œäº†')">
                            å®Œäº†ã«ã™ã‚‹
                        </button>
                    ` : ''}
                </div>
            `;

            return card;
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        async function updateStatus(orderId, newStatus) {
            try {
                const response = await fetch(`http://localhost:5000/api/orders/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                if (response.ok) {
                    loadOrders(); // å†èª­ã¿è¾¼ã¿
                }
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆ‡æ›¿
        function filterOrders(filter) {
            // ãƒœã‚¿ãƒ³ã®activeçŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.filters button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            displayOrders(filter);
        }
    </script>
</body>
</html>